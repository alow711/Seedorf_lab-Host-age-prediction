Any Mi-seq 16S amplicon sequencing pipeline.

Import paired end sequences into QIIME2: qiime 2 works by taking the fastq files and merging into a format it understands (qza).
removing the first 10 bases of each direction is usually a good practice
!!! no underscore in manifest file "_" just periods or dashes

Go to the biogeography directory /data/Henninglab/adrian/longterm

FUCK! SOU had named all the 515F sequences as reverse Fastq and 806R as forward fastq.

barcodes removed

Make sure the metadata and manifest files are the same. 
4 samples were removed (see longterm adrian edited mapping file.xlsx in removed worksheet for sample IDs removed from manifest.

Create manifest file with only forward reads.
#HPC-1:
qiime tools import \
  --type 'SampleData[SequencesWithQuality]' \
  --input-path manifest-all \
  --output-path single-end-demux.qza \
  --input-format SingleEndFastqManifestPhred33


qiime cutadapt trim-single \
  --i-demultiplexed-sequences single-end-demux.qza \
  --p-cores 4 \
  --p-front GTGYCAGCMGCCGCGGTAA \
  --o-trimmed-sequences single-end-trim-demux.qza

#HPC-2:
qiime demux summarize \
  --i-data single-end-demux.qza \
  --o-visualization single-end-demux.qzv

#HPC-3:
qiime dada2 denoise-single \
  --i-demultiplexed-seqs single-end-trim-demux.qza \
  --p-trim-left 0 \
  --p-trunc-len 176 \
  --p-n-threads 8 \
  --o-table table.qza \
  --o-representative-sequences rep-seqs.qza \
  --o-denoising-stats denoising-stats.qza

#HPC-4:
qiime metadata tabulate \
  --m-input-file denoising-stats.qza \
  --o-visualization denoising-stats.qzv
qiime feature-table tabulate-seqs \
   --i-data rep-seqs.qza \
   --o-visualization rep-seqs.qzv
qiime feature-table summarize \
  --i-table table.qza \
  --o-visualization table.qzv \
  --m-sample-metadata-file metadata.tsv

#HPC-5:
#5 animals per cage
qiime feature-table filter-features \
  --i-table table.qza \
  --p-min-samples 5 \
  --o-filtered-table table_features-sample.qza

qiime feature-table summarize \
  --i-table table_features-sample.qza \
  --o-visualization table_features-sample.qzv \
  --m-sample-metadata-file metadata.tsv

qiime tools export \
  --input-path table_features-sample.qza \
  --output-path table_features-sample

cd table_features-sample

biom convert -i feature-table.biom -o otus.tsv --to-tsv
rename *.tsv to .txt

For sourcetracker
removed M20-14-Aug from otus.txt

qiime feature-table filter-seqs \
  --i-data rep-seqs.qza \
  --i-table table_features-sample.qza \
  --o-filtered-data rep-seqs_filtered.qza
Saved FeatureData[Sequence] to: rep-seqs_filtered.qza

qiime feature-table tabulate-seqs \
   --i-data rep-seqs_filtered.qza \
   --o-visualization rep-seqs_filtered.qzv
Saved Visualization to: rep-seqs_filtered.qzv


# This is so that I can analyze only LTS data

qiime feature-table filter-samples \
  --i-table table_features-sample.qza \
  --m-metadata-file LTS-metadata.csv \
  --o-filtered-table LTS-filtered-table.qza

qiime feature-table summarize \
  --i-table LTS-filtered-table.qza \
  --o-visualization LTS-filtered-table.qzv \
  --m-sample-metadata-file LTS-metadata.csv

qiime feature-table filter-seqs \
  --i-data rep-seqs_filtered.qza \
  --i-table LTS-filtered-table.qza \
  --o-filtered-data LTS-rep-seqs_filtered.qza

qiime feature-table tabulate-seqs \
   --i-data LTS-rep-seqs_filtered.qza \
   --o-visualization LTS-rep-seqs_filtered.qzv

qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences LTS-rep-seqs_filtered.qza \
  --p-n-threads 8 \
  --o-alignment LTS-rep-seqs_filtered_aligned.qza \
  --o-masked-alignment LTS-rep-seqs_filtered_masked_aligned.qza \
  --o-tree LTS-rep-seqs_filtered_unrooted-tree.qza \
  --o-rooted-tree LTS-rep-seqs_filtered_rooted-tree.qza


qiime diversity core-metrics-phylogenetic \
  --i-phylogeny LTS-rep-seqs_filtered_rooted-tree.qza \
  --i-table LTS-filtered-table.qza \
  --p-sampling-depth 2733 \
  --m-metadata-file LTS-metadata.csv \
  --output-dir LTS-2733-core-metrics

qiime diversity beta-group-significance \
  --i-distance-matrix bray_curtis_distance_matrix.qza \
  --m-metadata-file LTS-metadata2.csv  \
  --m-metadata-column stages \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-9999-BC-stages \
  --verbose
qiime diversity beta-group-significance \
  --i-distance-matrix bray_curtis_distance_matrix.qza \
  --m-metadata-file LTS-metadata2.csv \
  --m-metadata-column Age_week \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-BC-Time \
  --verbose

qiime diversity beta-group-significance \
  --i-distance-matrix weighted_unifrac_distance_matrix.qza \
  --m-metadata-file LTS-metadata2.csv \
  --m-metadata-column Age_week \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-W_UniFrac-Time \
  --verbose

qiime diversity beta-group-significance \
  --i-distance-matrix weighted_unifrac_distance_matrix.qza \
  --m-metadata-file LTS-metadata2.csv \
  --m-metadata-column stages \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-9999-W_UniFrac-stages \
  --verbose

qiime tools export \
  --input-path table_features-sample.qza \
  --output-path table_features-sample

biom convert -i feature-table.biom -o otus.tsv --to-tsv
rename *.tsv to .txt
For sourcetracker
removed M20-14-Aug from otus.txt

qiime tools export \
  --input-path rarefied_table.qza \
  --output-path rarefied

biom convert -i feature-table.biom -o rarefied_2733.tsv --to-tsv
--------------------------------------------------20 Jul 21



Taxonomy assignment with SILVA 138

qiime feature-classifier classify-sklearn \
  --i-classifier silva-138-99-tax-515-806_q2020_2.qza  \
  --p-n-jobs -1 \
  --i-reads LTS-rep-seqs_filtered.qza \
  --o-classification silva-138-LTS.qza

qiime metadata tabulate \
  --m-input-file silva-138-LTS.qza \
  --o-visualization silva-138-LTS.qzv

qiime longitudinal feature-volatility \
  --i-table LTS-filtered-table.qza \
  --m-metadata-file LTS-metadata2.csv \
  --p-state-column Age_wk \
  --p-individual-id-column Age_week\
  --p-n-estimators 100 \
  --p-random-state 855 \
  --output-dir LTS-feat-volatility

cd LTS-feat-volatility

qiime tools export \
  --input-path feature_importance.qza \
  --output-path feature_importance


qiime taxa collapse \
  --i-table /home/adrian/Documents/LTS-biofecal-3/LTS-2733-core-metrics/rarefied_table.qza \
  --i-taxonomy 	silva-138-LTS.qza \
  --p-level 2 \
  --o-collapsed-table LTS-rarefiedtable-phylum.qza
qiime tools export \
  --input-path LTS-rarefiedtable-phylum.qza \
  --output-path LTS-rarefiedtable-phylum


biom convert -i feature-table.biom -o LTS-rarefied2733-phylum.tsv --to-tsv

qiime taxa collapse \
  --i-table /home/adrian/Documents/LTS-biofecal-3/LTS-2733-core-metrics/rarefied_table.qza \
  --i-taxonomy 	silva-138-LTS.qza \
  --p-level 5 \
  --o-collapsed-table LTS-rarefied-family.qza
qiime tools export \
  --input-path LTS-rarefied-family.qza \
  --output-path LTS-rarefied-family


biom convert -i feature-table.biom -o LTS-rarefied2733-family.tsv --to-tsv


For PCOA analysis of just biogeography dataset 
Note: csv file needs to be tab delimited

qiime feature-table filter-samples \
  --i-table table_features-sample.qza \
  --m-metadata-file biogeo-samples-to-keep.csv \
  --o-filtered-table biogeo-filtered-table.qza

qiime feature-table summarize \
  --i-table biogeo-filtered-table.qza \
  --o-visualization biogeo-filtered-table.qzv \
  --m-sample-metadata-file biogeo-samples-to-keep.csv

qiime feature-table filter-seqs \
  --i-data rep-seqs_filtered.qza \
  --i-table biogeo-filtered-table.qza \
  --o-filtered-data biogeo-rep-seqs_filtered.qza


qiime feature-table filter-samples \
  --i-table biogeo-filtered-table.qza \
  --m-metadata-file biogeo-samples-to-keep-for-prediction.csv \
  --o-filtered-table biogeo-filtered-table_age_prediction.qza

qiime feature-table summarize \
  --i-table biogeo-filtered-table_age_prediction.qza \
  --o-visualization biogeo-filtered-table-age-prediction.qzv \
  --m-sample-metadata-file biogeo-samples-to-keep-for-prediction.csv

qiime feature-table filter-seqs \
  --i-data biogeo-rep-seqs_filtered.qza \
  --i-table biogeo-filtered-table_age_prediction.qza \
  --o-filtered-data biogeo-rep-seqs_age_prediction_filtered.qza

qiime feature-table group \
  --i-table biogeo-filtered-table_age_prediction.qza \
  --p-axis sample \
  --m-metadata-file biogeo-samples-to-keep-for-prediction.csv \
  --m-metadata-column "GroupID" \
  --p-mode mean-ceiling \
  --o-grouped-table grouped-biogeo-filtered-table_age_prediction.qza

qiime feature-table summarize \
  --i-table grouped-biogeo-filtered-table_age_prediction.qza \
  --o-visualization grouped-biogeo-filtered-table_age_prediction.qzv \
  --m-sample-metadata-file biogeo-samples-to-keep-for-prediction-merged.csv

qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences biogeo-rep-seqs_age_prediction_filtered.qza \
  --p-n-threads 8 \
  --o-alignment biogeo-rep-seqs_age_prediction_filtered-aligned.qza \
  --o-masked-alignment biogeo-rep-seqs_age_prediction_filtered-aligned-masked-aligned.qza\
  --o-tree biogeo-rep-seqs_age_prediction_filtered-aligned-masked-aligned-tree.qza \
  --o-rooted-tree biogeo-rep-seqs_age_prediction_filtered-rooted-tree.qza


qiime diversity core-metrics-phylogenetic \
  --i-phylogeny biogeo-rep-seqs_age_prediction_filtered-rooted-tree.qza \
  --i-table grouped-biogeo-filtered-table_age_prediction.qza \
  --p-sampling-depth 9778 \
  --m-metadata-file biogeo-samples-to-keep-for-prediction-merged.csv \
  --output-dir biogeo-9778-core-metrics

qiime emperor plot \
  --i-pcoa bray_curtis_pcoa_results.qza \
  --m-metadata-file biogeo-samples-to-keep-for-prediction-merged.csv \
  --p-custom-axes Treatment \
  --o-visualization custom_pcoa_bray_curtis.qzv

qiime emperor plot \
  --i-pcoa weighted_unifrac_pcoa_results.qza \
  --m-metadata-file biogeo-samples-to-keep-for-prediction-merged.csv \
  --p-custom-axes Treatment \
  --o-visualization custom_pcoa_weight-Unifrac.qzv
Taxonomy assignment with SILVA 138

qiime feature-classifier classify-sklearn \
  --i-classifier silva-138-99-tax-515-806_q2020_2.qza  \
  --p-n-jobs -1 \
  --i-reads LTS-rep-seqs_filtered.qza \
  --o-classification silva-138-LTS.qza

qiime metadata tabulate \
  --m-input-file silva-138-LTS.qza \
  --o-visualization silva-138-LTS.qzv

qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences LTS-rep-seqs_filtered.qza \
  --p-n-threads 8 \
  --o-alignment LTS-rep-seqs_filtered_aligned.qza \
  --o-masked-alignment LTS-rep-seqs_filtered_masked_aligned.qza \
  --o-tree LTS-rep-seqs_filtered_unrooted-tree.qza \
  --o-rooted-tree LTS-rep-seqs_filtered_rooted-tree.qza


qiime diversity core-metrics-phylogenetic \
  --i-phylogeny LTS-rep-seqs_filtered_rooted-tree.qza \
  --i-table LTS-filtered-table.qza \
  --p-sampling-depth 2733 \
  --m-metadata-file LTS-metadata.csv \
  --output-dir LTS-2733-core-metrics
-------DEC21

After source tracker, I identified the samples for custom PcoA.

qiime feature-table filter-samples \
  --i-table biogeo-filtered-table_age_prediction.qza \
  --m-metadata-file biogeo_30percent_unknown.txt \
  --o-filtered-table biogeo-filtered-table_Dec21.qza

qiime feature-table summarize \
  --i-table biogeo-filtered-table_Dec21.qza \
  --o-visualization biogeo-filtered-table_Dec21.qzv \
  --m-sample-metadata-file biogeo-samples_Dec21.csv

qiime feature-table group \
  --i-table biogeo-filtered-table_Dec21.qza \
  --p-axis sample \
  --m-metadata-file biogeo-samples_Dec21.csv \
  --m-metadata-column "GroupID" \
  --p-mode mean-ceiling \
  --o-grouped-table grouped-biogeo-filtered-table_Dec21.qza

qiime feature-table summarize \
  --i-table grouped-biogeo-filtered-table_Dec21.qza \
  --o-visualization grouped-biogeo-filtered-table_Dec21.qzv \
  --m-sample-metadata-file biogeo-merged_Dec21.csv
13-Jun-treatment	16659
6-Jun-treatment	16432
31-July-control	15534
17-July-treatment	14842
10-July-control	13696
2-Jun-control	13073
2-Jun-treatment	12718
19-Jun-control	12087
31-July-treatment	11751
19-Jun-treatment	11726
24-July-control	11649
3-July-control	11540
26-Jun-control	11210
3-July-treatment	11089
24-July-treatment	10994
6-Jun-control	10860
26-Jun-treatment	10627
13-Jun-control	10526
17-July-control	10220
10-July-treatment	9932

qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences biogeo-rep-seqs_age_prediction_filtered.qza \
  --p-n-threads 8 \
  --o-alignment biogeo-rep-seqs-aligned_Dec21.qza \
  --o-masked-alignment biogeo-rep-seqs-masked-aligned_Dec21.qza\
  --o-tree biogeo-rep-seqs-masked-aligned_tree-Dec21.qza \
  --o-rooted-tree biogeo-rep-seqs-masked-aligned_rooted-tree-Dec21.qza


qiime diversity core-metrics-phylogenetic \
  --i-phylogeny biogeo-rep-seqs-masked-aligned_rooted-tree-Dec21.qza \
  --i-table grouped-biogeo-filtered-table_Dec21.qza \
  --p-sampling-depth 9932 \
  --m-metadata-file biogeo-merged_Dec21.csv \
  --output-dir biogeo-9932-core-metrics

qiime emperor plot \
  --i-pcoa bray_curtis_pcoa_results.qza \
  --m-metadata-file biogeo-merged_Dec21.csv \
  --p-custom-axes Treatment \
  --o-visualization custom_pcoa_bray_curtis.qzv


qiime emperor plot \
  --i-pcoa weighted_unifrac_pcoa_results.qza \
  --m-metadata-file biogeo-merged_Dec21.csv \
  --p-custom-axes Treatment \
  --o-visualization custom_pcoa_weight-Unifrac.qzv

qiime diversity core-metrics-phylogenetic \
  --i-phylogeny biogeo-rep-seqs-masked-aligned_rooted-tree-Dec21.qza \
  --i-table biogeo-filtered-table_Dec21.qza \
  --p-sampling-depth 5713 \
  --m-metadata-file biogeo-samples_Dec21.csv \
  --output-dir biogeo-5713-core-metrics


qiime diversity beta-group-significance \
  --i-distance-matrix bray_curtis_distance_matrix.qza \
  --m-metadata-file /home/adrian/Documents/LTS-biofecal-3/biogeo-9932-core-metrics/biogeo-merged_Dec21.csv \
  --m-metadata-column GroupID \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-9999-BC-GroupID 


qiime diversity beta-group-significance \
  --i-distance-matrix weighted_unifrac_distance_matrix.qza \
  --m-metadata-file biogeo-samples_Dec21.csv \
  --m-metadata-column GroupID \
  --p-method permanova \
  --p-pairwise \
  --p-permutations 9999 \
  --o-visualization Permanova-9999-UniFrac-GroupID 


--------------Alpha-diversity and statistical test using linear mixed effect model
https://forum.qiime2.org/t/alpha-and-beta-diversity-explanations-and-commands/2282

qiime diversity alpha \
  --i-table rarefied_table.qza \
  --p-metric simpson \
  --o-alpha-diversity simpson_vector.qza

qiime diversity alpha \
  --i-table rarefied_table.qza \
  --p-metric chao1 \
  --o-alpha-diversity chao1_vector.qza

qiime diversity alpha \
  --i-table rarefied_table.qza \
  --p-metric pielou_e \
  --o-alpha-diversity pielou_e_vector.qza

Added 


qiime metadata tabulate \
  --m-input-file shannon_vector.qza \
  --o-visualization shannon_vector.qzv

#significant change over time?
Analysis between lifephases still use paired Wilcoxon test.

Show pairwise alpha-diversity differences between life phase

Wilcoxon signed rank sum test to test within mice grouped by cohort.
I created two columns called cohort and stages3. In cohort, I named all the subjects i'm interest as as cohort 1 and the remaining samples as cohort 2  for stage 3 i include maturing and matured to both cohorts. 

As I only care about the Wilcoxon signed sum test within samples.I will ignore the krustal wallis and Mann Witney U tests.

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file shannon_vector.qza \
  --p-metric shannon_entropy \
  --p-group-column Cohort-MR-MA \
  --p-state-column StagesMR-MA \
  --p-state-1 maturing \
  --p-state-2 matured \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Shannon-pairwise-differences-MR-MA.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file shannon_vector.qza \
  --p-metric shannon_entropy \
  --p-group-column Cohort-MA-MD \
  --p-state-column StagesMA-MD \
  --p-state-1 matured \
  --p-state-2 Middle-age \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Shannon-pairwise-differences-MA-MD.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file shannon_vector.qza \
  --p-metric shannon_entropy \
  --p-group-column Cohort-MD-OD \
  --p-state-column StagesMD-OD \
  --p-state-1 Middle-age \
  --p-state-2 old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Shannon-pairwise-differences-MD-OD.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file shannon_vector.qza \
  --p-metric shannon_entropy \
  --p-group-column Cohort-OD-VO \
  --p-state-column StagesOD-VO \
  --p-state-1 old \
  --p-state-2 very_old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Shannon-pairwise-differences-OD-VO.qzv



qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file pielou_e_vector.qza \
  --p-metric pielou_evenness \
  --p-group-column Cohort-MR-MA \
  --p-state-column StagesMR-MA \
  --p-state-1 maturing \
  --p-state-2 matured \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Pielou-pairwise-differences-MR-MA.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file pielou_e_vector.qza \
  --p-metric pielou_evenness \
  --p-group-column Cohort-MA-MD \
  --p-state-column StagesMA-MD \
  --p-state-1 matured \
  --p-state-2 Middle-age \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Pielou-pairwise-differences-MA-MD.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file pielou_e_vector.qza \
  --p-metric pielou_evenness \
  --p-group-column Cohort-MD-OD \
  --p-state-column StagesMD-OD \
  --p-state-1 Middle-age \
  --p-state-2 old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Pielou-pairwise-differences-MD-OD.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file pielou_e_vector.qza \
  --p-metric pielou_evenness \
  --p-group-column Cohort-OD-VO \
  --p-state-column StagesOD-VO \
  --p-state-1 old \
  --p-state-2 very_old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization Pielou-pairwise-differences-OD-VO.qzv



qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file chao1_vector.qza \
  --p-metric chao1 \
  --p-group-column Cohort-MR-MA \
  --p-state-column StagesMR-MA \
  --p-state-1 maturing \
  --p-state-2 matured \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization chao1-pairwise-differences-MR-MA.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file chao1_vector.qza \
  --p-metric chao1 \
  --p-group-column Cohort-MA-MD \
  --p-state-column StagesMA-MD \
  --p-state-1 matured \
  --p-state-2 Middle-age \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization chao1-pairwise-differences-MA-MD.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file chao1_vector.qza \
  --p-metric chao1 \
  --p-group-column Cohort-MD-OD \
  --p-state-column StagesMD-OD \
  --p-state-1 Middle-age \
  --p-state-2 old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization chao1-pairwise-differences-MD-OD.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file chao1_vector.qza \
  --p-metric chao1 \
  --p-group-column Cohort-OD-VO \
  --p-state-column StagesOD-VO \
  --p-state-1 old \
  --p-state-2 very_old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization chao1-pairwise-differences-OD-VO.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file simpson_vector.qza \
  --p-metric simpson \
  --p-group-column Cohort-MR-MA \
  --p-state-column StagesMR-MA \
  --p-state-1 maturing \
  --p-state-2 matured \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization simpson-pairwise-differences-MR-MA.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file simpson_vector.qza \
  --p-metric simpson \
  --p-group-column Cohort-MA-MD \
  --p-state-column StagesMA-MD \
  --p-state-1 matured \
  --p-state-2 Middle-age \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization simpson-pairwise-differences-MA-MD.qzv


qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file simpson_vector.qza \
  --p-metric simpson \
  --p-group-column Cohort-MD-OD \
  --p-state-column StagesMD-OD \
  --p-state-1 Middle-age \
  --p-state-2 old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization simpson-pairwise-differences-MD-OD.qzv

qiime longitudinal pairwise-differences \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file simpson_vector.qza \
  --p-metric simpson \
  --p-group-column Cohort-OD-VO \
  --p-state-column StagesOD-VO \
  --p-state-1 old \
  --p-state-2 very_old \
  --p-individual-id-column mouse \
  --p-replicate-handling random \
  --o-visualization simpson-pairwise-differences-OD-VO.qzv


Is there a difference in trend between year 1 and year 2.
#year
Simpson
qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file simpson_vector.qza \
  --p-metric simpson \
  --p-group-columns Year\
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_simpson_year.qzv

qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file shannon_vector.qza \
  --p-metric shannon_entropy \
  --p-group-columns Year\
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_shannon_year.qzv


qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file pielou_e_vector.qza \
  --p-metric pielou_evenness \
  --p-group-columns Year \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_peilou_year.qzv

qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file chao1_vector.qza \
  --p-metric chao1 \
  --p-group-columns Year\
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_chao1_cohort.qzv


Beta-diversity Find first_distance between successive time-points.
Q. How different are the microbiota among the life phases?

qiime longitudinal first-distances \
  --i-distance-matrix weighted_unifrac_distance_matrix.qza \
  --m-metadata-file LTS-metadata_cage.csv \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --o-first-distances W_UniFrac_1st_dist.qza

qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file W_UniFrac_1st_dist.qza \
  --p-metric Distance \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-group-columns stages2 \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_W_UniFrac_1st_dist.qzv


qiime longitudinal volatility \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file W_UniFrac_1st_dist.qza \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-default-group-column stages2 \
  --o-visualization W_UniFrac_1st_dist_volatility.qzv


qiime longitudinal first-distances \
  --i-distance-matrix bray_curtis_distance_matrix.qza \
  --m-metadata-file LTS-metadata_cage.csv \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --o-first-distances bray_curtis_1st_dist.qza


qiime longitudinal linear-mixed-effects \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file bray_curtis_1st_dist.qza \
  --p-metric Distance \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-group-columns stages2 \
  --p-random-effects mouse,Age_wk \
  --o-visualization LME_bray_curtis_1st_dist.qzv

qiime longitudinal volatility \
  --m-metadata-file LTS-metadata_cage.csv \
  --m-metadata-file bray_curtis_1st_dist.qza \
  --p-state-column Age_wk \
  --p-individual-id-column mouse \
  --p-default-group-column stages2 \
  --o-visualization bray_curtis_1st_dist.qzv

